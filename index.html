<script>
        // --- 1. SIDEBAR LOGIC ---
        function toggleSidebar() {
            const sidebar = document.getElementById('mySidebar');
            sidebar.classList.toggle('open');
        }

        // --- 2. MODAL POPUP LOGIC ---
        const modal = document.getElementById("projectModal");
        const modalTitle = document.getElementById("modalTitle");
        const modalBody = document.getElementById("modalBody");

        // Function to open modal and fill data
        function openModal(data) {
            modalTitle.innerText = data.name; // Set title
            
            // Create the HTML for the description + A button to the report
            let content = data.desc;
            if (data.url) {
                content += `<br><br><a href="${data.url}" target="_blank" class="btn">Read Full Report &rarr;</a>`;
            }
            
            modalBody.innerHTML = content; 
            modal.style.display = "block"; 
            world.autoRotate(false); // Pause rotation
        }

        function closeModal() {
            modal.style.display = "none";
            world.autoRotate(true); // Resume rotation
        }
        
        window.onclick = function(event) {
            if (event.target == modal) { closeModal(); }
        }

        // --- 3. YOUR PROJECT DATA ---
        // I added the 'url' field. You can put links to PDFs or other pages there.
        const myProjects = [
            {
                lat: -1.2921, lng: 36.8219,
                name: "Kenya: Agricultural Mapping",
                desc: "Mapping smallholder farms using Sentinel-2 to estimate crop yields.",
                url: "project-kenya.html" // Change this to your actual link/PDF
            },
            {
                lat: 51.5074, lng: -0.1278,
                name: "UK: Urban Heat Islands",
                desc: "Analyzing Land Surface Temperature (LST) variations in London.",
                url: "#"
            },
            {
                lat: 41.9028, lng: 12.4964,
                name: "Italy: Historical InSAR",
                desc: "Monitoring ground deformation risks near ancient Roman heritage sites.",
                url: "#"
            },
             {
                lat: -15.8267, lng: -47.9218,
                name: "Brazil: Deforestation Alerts",
                desc: "Deep learning segmentation for near real-time forest loss alerts.",
                url: "#"
            },
            {
                lat: 42.6977, lng: 23.3219,
                name: "Bulgaria: Forest Cover",
                desc: "Decadal change detection analysis using the Landsat archive.",
                url: "#"
            },
             {
                lat: 48.2082, lng: 16.3738,
                name: "Austria: Alpine Snow",
                desc: "Tracking seasonal snow line retreat using MODIS data.",
                url: "#"
            },
            {
                lat: 78.2232, lng: 15.6267, // Longyearbyen coordinates
                name: "The Arctic: Sea Ice Thickness",
                desc: "CryoSat-2 altimetry processing to measure ice volume changes.",
                url: "#"
            }
        ];

        // --- 4. GLOBE CONFIGURATION ---
        const world = Globe()
            (document.getElementById('globeViz'))
            .globeImageUrl('//unpkg.com/three-globe/example/img/earth-blue-marble.jpg')
            .bumpImageUrl('//unpkg.com/three-globe/example/img/earth-topology.png')
            .backgroundImageUrl('//unpkg.com/three-globe/example/img/night-sky.png')
            .atmosphereColor('#3a228a')
            .atmosphereAltitude(0.25)
            .autoRotate(true)
            .autoRotateSpeed(0.5)
            
            // --- FIX START: FORCE DOT RENDERING ---
            .pointsData(myProjects) 
            .pointLat('lat')  // Explicitly tell it where latitude is
            .pointLng('lng')  // Explicitly tell it where longitude is
            .pointColor(() => '#00ffcc') 
            .pointAltitude(0.05) // Lifted them higher so they don't clip into mountains
            .pointRadius(0.8)    // Made them bigger so they are easier to click
            .pointResolution(32) 
            // --- FIX END ---
            
            .onPointClick(pointData => {
                openModal(pointData);
            });
    </script>
